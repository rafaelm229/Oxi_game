<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jogo da MemÃ³ria Oxxi</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-image: url('/assets/background/bg_jogo.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
    }

    h1 {
      color: #a7fb00;
      text-align: center;
    }

    .game-container {
      background-color: #131412;
      padding: 20px;
      border-radius: 20px;
      display: grid;
      grid-template-columns: repeat(4, 160px);
      grid-gap: 10px;
      justify-content: center;
      box-shadow: 0 0 15px rgba(167, 251, 0, 0.3);
    }

      .card {
        width: 150px;
        height: 150px;
        background-color: #070906;
        border: 2px solid #a7fb00;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.3s, background-color 0.3s;
        overflow: hidden;
      }

      .card img {
        width: 80%;
        height: 80%;
        object-fit: contain;
        display: none;
        pointer-events: none;
      }

    .card.flipped, .card.matched {
      background-color: #a7fb00;
      transform: scale(1.05);
    }

    .card.flipped img, .card.matched img {
      display: block;
    }

    #scoreboard {
      margin-top: 15px;
      color: #FFFFFF;
      font-size: 1rem;
      text-align: center;
    }

    @media (max-width: 500px) {
      .game-container {
        grid-template-columns: repeat(3, 70px);
      }
      .card {
        width: 70px;
        height: 70px;
      }
    }
  </style>
</head>
<body>
  <h1>Jogo da MemÃ³ria Oxxi ðŸŽ¯</h1>
  <div id="scoreboard">
    Tempo Restante: <span id="countdown">45</span>s | Tentativas: <span id="moves">0</span>
  </div>
  <div class="game-container" id="game"></div>
 

  <script>
    // Image files found in front/assets/imagens_bichos
    const imageFiles = [
      'Ativo 1.png',
      'Ativo 2.png',
      'Ativo 3.png',
      'Ativo 4.png',
      'Ativo 5.png',
      'Ativo 6.png',
      'Ativo 7.png',
      'Ativo 8.png'
    ];

    // Build full paths and ensure we have at least 8 distinct images by repeating if needed
    const basePath = '/assets/imagens_bichos/';
    let cardsData = imageFiles.map(f => basePath + f);
    while (cardsData.length < 8) {
      cardsData = cardsData.concat(cardsData.slice(0, 8 - cardsData.length));
    }
    cardsData = cardsData.slice(0, 8);
    let cards = [...cardsData, ...cardsData];
    let flipped = [];
    let matched = 0;
    let moves = 0;
    let countdown = 45;
    let countdownInterval;
    const gameContainer = document.getElementById('game');
    const movesDisplay = document.getElementById('moves');
    const countdownDisplay = document.getElementById('countdown');

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function createCards() {
      shuffle(cards).forEach(icon => {
        const card = document.createElement('div');
        card.classList.add('card');
        card.dataset.icon = icon;

        // image element inside card
        const img = document.createElement('img');
        img.src = icon;
        img.alt = 'animal';
        card.appendChild(img);

        card.addEventListener('click', flipCard);
        gameContainer.appendChild(card);
      });

      // Show a brief preview of all images for 2 seconds before starting
      previewAllImages();
    }

    function flipCard() {
      if (flipped.length === 2 || this.classList.contains('flipped') || this.classList.contains('matched')) return;
      this.classList.add('flipped');
      flipped.push(this);
      if (flipped.length === 2) {
        moves++;
        movesDisplay.textContent = moves;
        checkMatch();
      }
    }

    function checkMatch() {
      const [card1, card2] = flipped;
      if (card1.dataset.icon === card2.dataset.icon) {
        card1.classList.add('matched');
        card2.classList.add('matched');
        matched += 2;
        flipped = [];
        if (matched === cards.length) endGame();
      } else {
        setTimeout(() => {
          card1.classList.remove('flipped');
          card2.classList.remove('flipped');
          flipped = [];
        }, 800);
      }
    }

    function previewAllImages() {
      // disable interaction during preview
      gameContainer.style.pointerEvents = 'none';
      const allCards = Array.from(document.querySelectorAll('.card'));
      allCards.forEach(c => c.classList.add('flipped'));

      setTimeout(() => {
        allCards.forEach(c => c.classList.remove('flipped'));
        gameContainer.style.pointerEvents = 'auto';
        startCountdown();
      }, 3000);
    }

    function startCountdown() {
      countdownInterval = setInterval(() => {
        countdown--;
        countdownDisplay.textContent = countdown;
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      clearInterval(countdownInterval);
      // desabilitar cartas apÃ³s tÃ©rmino
      document.querySelectorAll('.card').forEach(card => 
        card.removeEventListener('click', flipCard)
      );
      finishGame();
    }

    // Chama esta funÃ§Ã£o quando o timer do jogo chegar a zero
    function finishGame() {
      // tenta usar variÃ¡veis jÃ¡ existentes
      let pontosCalc = null;

      if (typeof pontos !== 'undefined' && pontos !== null) {
        pontosCalc = Number(pontos);
      } else if (typeof score !== 'undefined' && score !== null) {
        pontosCalc = Number(score);
      } else if (typeof matchedPairs !== 'undefined' && matchedPairs !== null) {
        // exemplo caso exista contador de pares
        pontosCalc = Number(matchedPairs) * 10;
      } else {
        // fallback: conta elementos DOM marcados como combinados (.card.matched)
        const matchedCards = document.querySelectorAll('.card.matched').length;
        const pares = Math.floor(matchedCards / 2);
        pontosCalc = pares * 10;
      }

      // Garantir nÃºmero inteiro >= 0
      pontosCalc = Number.isFinite(pontosCalc) ? Math.max(0, Math.floor(pontosCalc)) : 0;

      // Salva a pontuaÃ§Ã£o no localStorage para a pÃ¡gina resumo ler
      localStorage.setItem('pontuacao', String(pontosCalc));

      // Bloqueia interaÃ§Ãµes (opcional)
      document.body.style.pointerEvents = 'none';

      // Redireciona para a pÃ¡gina de resumo apÃ³s curto delay (pode ajustar)
      setTimeout(() => {
        window.location.href = 'resumo.html';
      }, 300); // 300ms para permitir possÃ­veis animaÃ§Ãµes; quem chama pode usar 0ms
    }

    // Exemplo: substituir a chamada atual do timer por finishGame()
    // se vocÃª tiver algo como: if (timeLeft <= 0) { /* ... */ }
    // troque por:
    // if (timeLeft <= 0) { finishGame(); }

    // Se existir um botÃ£o "finalizar" ou "ver resumo", liga o clique
    const btnResumo = document.getElementById('btn-resumo'); // id opcional no HTML
    if (btnResumo) {
      btnResumo.addEventListener('click', finishGame);
    }

    createCards();
  </script>
</body>
</html>
